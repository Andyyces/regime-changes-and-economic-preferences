---
title: "Regime Changes and Economic Preferences: Global Evidence"
subtitle: "Milestone 3: Econometric Approach"
author: "Andrea Češková and Elvin Mammadov"
format: 
  pdf:
    reference-location: document
number-sections: true
toc: true
crossref:
  fig-title: "Figure"
  tbl-title: "Table"
  eq-title: "Equation"
  lot-title: "List of figures"
bibliography: references.bib
link-citations: true
---

```{r}
#| message: false
#| warning: false
#| include: false
#  Load the function from extract_codes.R

source("../Input/extract_codes.R")

#  Use it to extract code from the Rmd into an R script
extract_r_code_from_rmd("../Input/Data loading + wrangling.Rmd", "../Input/data_wrangle.R")

#  Run the extracted R code
source("../Input/data_wrangle.R")

write_dta(final_data_gdp, path = "../Input/final_data_gdp.dta")

```

# Economic model

As Detlefsen et al. [-@detlefsen_are_2024] points out, the formation of economic preferences in **childhood** and **adolescence** has a long-term consequences for life outcomes. To provide an example, patience can impact one's school performance, which can later translate to education attainment and labor market outcomes. The same way can risk preference impact one's financial decisions [@detlefsen_are_2024].

According to the National Library of Medicine, childhood is defined as a stage from **3-11 years** and adolescence as a stage from **12-18 years**[@balasundaram2025]. But what factors can have an impact on economic preferences?

# Setting

Treatment definition was one of our main tasks until now. Our goal was to capture both **sudden** and **gradual regime changes** and direction of change (democratization/autocratization) according to changes in **LDI** (Liberal Democracy Index).

We followed similar methodology as described in [@luhrmann_autocratization_2020], which is based on the evaluating differences of the LDI at time ***t*** and time ***t-10.*** Afterwards, following steps are executed:

-   Computation of standard errors and **confidence intervals** of the respective changes.If the **confidence intervals don't overlap** and the **absolute value of the change in LDI is higher than 0.05**, the change in LDI is recognized as significant and identified as regime change.

-   If regime change in a country at time t is identified, we take a look into the gps dataset and **assign the treatment to individuals, who are between 3-18 years at the time of regime change in their country**.

```{r}
#| echo: false
#| label: tbl-c
#| tbl-cap: Number of treatment variables
#| tbl-pos: "H"
table(final_data$formative_regime_change)
```

```{r}
#| echo: false
#| label: fig-a
#| warning: false
#| results: 'asis'
#| fig-cap: "Mean Preference Profiles by Regime Change Exposure"
#| fig-cap-location: top
#| fig-pos: "H"
p_load(dplyr,
       kableExtra)
long_data <- final_data_gdp %>%
  pivot_longer(
    cols = c(trust, patience, risktaking, posrecip, negrecip, altruism),
    names_to = "preference_type",
    values_to = "value"
  ) %>%
  mutate(preference_type = str_to_title(preference_type))

# Change the formative_regime_change factor levels and labels
long_data <- long_data %>%
  mutate(formative_regime_change = case_when(
    formative_regime_change == 0 ~ "Control",
    formative_regime_change == 1 ~ "Treated",
    TRUE ~ as.character(formative_regime_change)
  ))

# Calculating group means and confidence intervals
group_means <- long_data %>%
  group_by(formative_regime_change, preference_type) %>%
  summarise(
    mean_value = mean(value, na.rm = TRUE),
    se = sd(value, na.rm = TRUE) / sqrt(n()),
    ci_lower = mean_value - 1.96 * se,
    ci_upper = mean_value + 1.96 * se,
    .groups = "drop"
  )

# Order factors to make Treated come FIRST so it gets the first color (red in Set1)
group_means$formative_regime_change <- factor(
  group_means$formative_regime_change,
  levels = c("Treated", "Control")
)

# Ordering from smallest to highest differences between groups
differences <- group_means %>%
  select(preference_type, formative_regime_change, mean_value) %>%
  pivot_wider(names_from = formative_regime_change, values_from = mean_value) %>%
  mutate(difference = abs(Treated - Control)) %>%
  arrange(difference) %>%
  select(preference_type, difference)

# Create ordered factor for preference_type based on differences
group_means$preference_type <- factor(group_means$preference_type, 
                                      levels = differences$preference_type)

grouped_bar_plot <- ggplot(group_means, aes(x = preference_type, y = mean_value, fill = formative_regime_change)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = round(mean_value, 3)), 
            position = position_dodge(width = 0.8), 
            vjust = ifelse(group_means$mean_value >= 0, -0.3, 1.2),
            size = 3.5,
            fontface = "bold") +
  scale_fill_manual(values = c("Treated" = "#D62728", "Control" = "#1F77B4"),
                    name = "Group") +
  scale_y_continuous(expand = expansion(mult = c(0.1, 0.1))) +  # Add space for labels
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title = element_text(size = 12),
    legend.position = "top"
  ) +
  labs(
    caption = "Mean values displayed above/below bars",
    x = element_blank(),
    y = "Mean Value"
  ) +
  geom_hline(yintercept = 0, linetype = "dotted", color = "gray50", size = 0.5)

# Print the plot
print(grouped_bar_plot)
```

In the table @tbl-preferences we examine the difference in mean in mean on a more formal level. We perform t-tests of the differences. All of them seems to be statistically significant on a 0.001 confidence level. This points out in a direction for our analysis.

```{r}
#| include: false
# Function to perform t-tests and format results
create_ttest_table <- function(data, vars) {
  
  # Initialize results list
  results <- list()
  
  # Ensure formative_regime_change is numeric
  data$formative_regime_change <- as.numeric(data$formative_regime_change)
  
  # Control vs Treatment indicators
  control_group <- data$formative_regime_change == 0
  treatment_group <- data$formative_regime_change == 1
  
  # Check that we have both groups
  if(sum(control_group) == 0) stop("No control group (formative_regime_change = 0) found")
  if(sum(treatment_group) == 0) stop("No treatment group (formative_regime_change = 1) found")
  
  # For each variable, perform t-test and extract statistics
  for(var in vars) {
    # Extract values for control and treatment
    control_vals <- data[[var]][control_group]
    treat_vals <- data[[var]][treatment_group]
    
    # Remove NA values
    control_vals <- control_vals[!is.na(control_vals)]
    treat_vals <- treat_vals[!is.na(treat_vals)]
    
    # Calculate means and SDs
    control_mean <- mean(control_vals)
    control_sd <- sd(control_vals)
    treat_mean <- mean(treat_vals)
    treat_sd <- sd(treat_vals)
    
    # Perform t-test
    t_test <- t.test(treat_vals, control_vals)
    diff <- treat_mean - control_mean
    p_value <- t_test$p.value
    
    # Add significance stars
    stars <- ifelse(p_value < 0.001, "***",
                   ifelse(p_value < 0.01, "**",
                         ifelse(p_value < 0.05, "*",
                               ifelse(p_value < 0.1, "+", ""))))
    
    # Format the results
    control_text <- sprintf("%.3f\n(%.3f)", control_mean, control_sd)
    treat_text <- sprintf("%.3f\n(%.3f)", treat_mean, treat_sd)
    diff_text <- sprintf("%.3f%s\n(%.3f)", diff, stars, t_test$stderr)
    
    # Store results
    results[[var]] <- c(
      Variable = var,
      Control = control_text,
      Treatment = treat_text,
      Difference = diff_text
    )
  }
  
  # Convert to data frame
  table_df <- do.call(rbind, results)
  row.names(table_df) <- NULL
  
  # Create the table using kableExtra for PDF output
  require(kableExtra)
  
  # Clean variable names for display
  display_names <- c(
    trust = "Trust",
    patience = "Patience",
    risktaking = "Risk Taking",
    posrecip = "Positive Reciprocity",
    negrecip = "Negative Reciprocity",
    altruism = "Altruism",
    subj_math_skills = "Subjective Math Skills"
  )
  
  # Replace variable names with display names
  table_df[,1] <- ifelse(table_df[,1] %in% names(display_names), 
                        display_names[table_df[,1]], 
                        table_df[,1])
  
  # Create styled table (without caption - handle in document)
  kbl(table_df, 
      booktabs = TRUE,
      col.names = c("", "Control Group", "Treatment Group", "Difference"),
      align = c("l", "c", "c", "c"),
      escape = TRUE) %>%
    kable_styling() %>%
    add_header_above(c(" " = 1, "Mean (SD)" = 3)) %>%
    column_spec(1, width = "2.5cm") %>%
    column_spec(2:4, width = "2cm") %>%
    footnote(general = "Standard deviations in parentheses. Standard errors for differences in parentheses.",
             symbol = c("*** p<0.001, ** p<0.01, * p<0.05, + p<0.1"),
             threeparttable = TRUE,
             general_title = "Note:",
             escape = TRUE)
}
```

```{r}
#| echo: false
#| label: tbl-preferences
#| warning: false
#| results: 'asis'
#| tbl-cap: "Economic Preferences Comparison by Group"
#| tbl-pos: "H"
# Create the table
preferences_vars <- c("trust", "patience", "risktaking", "posrecip", "negrecip", "altruism")
preferences_table <- create_ttest_table(final_data_gdp, preferences_vars)

# Render the table
preferences_table
```

```{r}
#| label: tbl-controls
#| eval: false
#| warning: false
#| include: false
#| results: asis
#| tbl-cap: Control Variables Comparison by Group
#| tbl-pos: H
# Create the table
controls_vars <- c("age", "gdppc_2012", "subj_math_skills")
controls_table <- create_ttest_table(final_data_gdp, controls_vars)

# Render the table
controls_table
```

# Mechanism

Our core hypothesis is that political regime changes during formative years (ages 3--18) have lasting impacts on non-cognitive preferences. This aligns with psychosocial development theory [@balasundaram_human_2025; @detlefsen_are_2024].

We cannot test the mechanism directly, but we test its implications through a Difference-in-Differences (DiD) approach:

-   Individuals are assigned to treatment if they experienced a regime change during their formative years.
-   All individuals are surveyed in the same period (2012--2013), minimizing confounding from external shocks.

This setup controls for country-specific time-invariant factors and period shocks. Our methodology is similar to cohort-based DiD approaches used by [@friehe_time_2020] and [@fuchs-schundeln_endogeneity_2015].

We additionally test the intensity of treatment by examining whether the number of years spent under the new regime correlates with preference scores.

Possible estimators: [@callaway_difference-differences_2024], [@borusyak_revisiting_2024], [@de_chaisemartin_two-way_2020]. In our current setting, the treatment assignment happens just once.

# Source of Bias and Identification

Our identification strategy leverages a DiD design comparing cohorts within countries based on exposure to regime change during formative years. We estimate the **Average Treatment Effect on the Treated (ATT)**, assuming parallel trends.

### Potential Biases and Mitigation

-   **Endogeneity of regime change exposure:**\
    Exposure is not random, but we exploit birth year variation within countries. Similar to the quasi-experimental setup in [@fuchs-schundeln_endogeneity_2015].

-   **Time-invariant country-level confounding:**\
    Fixed effects absorb differences in culture, geography, or historical institutions.

-   **Measurement of regime change:**\
    Defined as statistically significant changes in LDI over a 10-year span, [@luhrmann_autocratization_2020].

-   **Residual selection bias:**\
    Countries with frequent regime changes may differ systematically (e.g., lower GDP), leading to downward bias in preference measures.

# Formulas

The equation of our main baseline model is as following:

$$
Y_{ict} = \alpha + \beta \cdot \text{RegimeChange}_{ic} + \gamma_c + \delta_t + X_{ict} \cdot \text{(Controls)} + \varepsilon_{ict}
$$ Where:

-   **Outcome:** $Y_{ict}$: Economic preference outcome (trust, patience, etc.) for **individual** ( i ), **region** ( r ), **birth cohort** ( t )

-   **Treatment:** $\text{RegimeChange}_{ic}$: Binary treatment indicator (1 if experienced democratization/autocratization during formative years, 0 otherwise)

-   $\delta_t$ : Birth cohort fixed effects

-   $\gamma_r$ : Region fixed effects

-   $X_{ict}$ : **Controls** including:

    -   Average V-Dem democracy index score experienced during formative years (ages 3-18)

    -   Average GDP of the country of residence during formative years (ages 3-18)

    -   Subjective math skills

    We acknowledge that including the "Subjective math skills" as a part of the control variables might be problematic, because of the reverse causality problem.

# Identified Types of Effects

We use DiD to estimate the **ATT**: the effect of regime change exposure on those who actually experienced it.

### Identification Assumptions

The TWFE estimator is still able to provide evidence on causal inference, as long as the **conditional independence assumption** holds. In our case it means the following:

# Questions for meeting on 12.3.

-   After running the basic regression -\> effect of formative_regime_change significant but low R2

-   Regarding the methodology as described in "Setting": We are capturing democratization/autocratization as a regime change. But maybe not all democratization/autocratization process must necessarily mean the regime has changed? Should we consider another criterion which at the end evaluates if the value of LDI is: above 0.5 -\> liberal democracy, below 0.5 -\> autocracy?

-   Treatment assignment: With the current approach, there is a lot of observations who, according to our function, experience regime change at age 0. It is because the function evaluates just the first democratization/autocratization occurence. But I keep thinking there could be more such episodes? Should we aim to capture also other episodes OR change the confidence intervals threshold? This problem also connects to the next question:

-   How do we calculate the years that have passed since the new regime change? For example, maybe a person changed regimes twice in his formative years? How do we calculate this? Or just we count from the first change?

-   Adding interaction term $TimeToTreatment_{c,t,k}$ as an indicator for being $k$ **periods away from the treatment** (regime change) in country $c$ at time $t$?

average democratization between 16-25 -\> treatment just when its sudden germany how much change in vdem in 1990? capture sudden changes rather than trends

average vdem score the individual experience in formative years -\> maybe more feasible democratization/autocratization dummy as a treatment

regress econ preferences on average vdem scores experienced in youth average GDP between birthy-year and year adult

as control age effects and cohort effects -\> use just one we cant use both pseudo panel -\> event study -\> rather go with cross sections -\> vdem index in formative years influences preferences country

conditial independence assumption -\> still can be causal

math skills can also be an outcome

change just to regime_change

simple OLS just cross section -\> if we trust conditional independence assumption -\> how to make use of different cohorts in the dataset -\> instrument?

focus on average vdem index in formative years staggered DiD: years relative to treatment

# References
