---
title: "Regime Changes and Economic Preferences: Global Evidence"
subtitle: "Milestone 2: Data"
author: "Andrea Češková and Elvin Mammadov"
crossref:
  fig-title: "Figure"
  tbl-title: "Table"
bibliography: references.bib
format: 
  pdf:
    reference-location: document
link-citations: true
---

```{r}
#| message: false
#| warning: false
#| include: false
#  Load the function from extract_codes.R
source("../Input/extract_codes.R")

#  Use it to extract code from the Rmd into an R script
extract_r_code_from_rmd("../Input/Data loading + wrangling.Rmd", "../Input/data_wrangle.R")

#  Run the extracted R code
source("../Input/data_wrangle.R")


```

# Sources

In our project, we are making use of 3 datasets:

-   Vdem (@coppedge_v-dem_2025) dataset comes also as an R package:`vdemdata`. This dataset contains various democracy indicators for 202 countries starting of year 1789. We will be using the **Liberal democracy index which** combines many of these indicators into a single number for each country/year.

-   Global Preference Survey (@falk_global_2018) dataset was downloaded as a ZIP file from the [following website](https://gps.iza.org/downloads). This dataset contains information about economic preferences of 80337 individuals from 76 countries. The survey was conducted between 2012 and 2013.

-   Data on country's GDP's was downloaded from the [Maddison Project Database 2023](https://www.rug.nl/ggdc/historicaldevelopment/maddison/releases/maddison-project-database-2023) (@bolt_maddison-style_2025). This dataset was downloaded on 5th May 2025.

# Data

The following table @tbl-gps shows how were the economic preferences from the GPS survey (@falk_global_2018) measured. The table @tbl-libdem shows how the LDI was calculated.

+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+
| Preference               | Measurement Approach                  | Description                                                                                                 | Scale (min--max) |
+:=========================+:======================================+:============================================================================================================+:=================+
| Time Preference/Patience | Combined quantitative and qualitative | • Quantitative: Five binary choices between immediate vs. delayed financial rewards (today or in 12 months) | -1.3 -- 2.8      |
|                          |                                       |                                                                                                             |                  |
|                          |                                       | • Qualitative: Self-assessment on willingness to wait (11-point Likert scale)                               |                  |
+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+
| Risk Preference          | Combined quantitative and qualitative | • Quantitative: Five binary choices between fixed lottery and varying sure payments                         | -1.9 -- 2.5      |
|                          |                                       |                                                                                                             |                  |
|                          |                                       | • Qualitative: Self-assessment (11-point Likert scale)                                                      |                  |
+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+
| Positive Reciprocity     | Combined quantitative and qualitative | • Quantitative: Scenario about giving a gift to a helpful stranger (choice of presents worth 5-30 euros)    | -3.8 -- 1.3      |
|                          |                                       |                                                                                                             |                  |
|                          |                                       | • Qualitative: Self-assessment on willingness to return favors (11-point Likert scale)                      |                  |
+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+
| Negative Reciprocity     | Three qualitative self-assessments    | • Willingness to take revenge at personal cost                                                              | -1.6 -- 2.3      |
|                          |                                       |                                                                                                             |                  |
|                          |                                       | • Willingness to punish unfair behavior toward self                                                         |                  |
|                          |                                       |                                                                                                             |                  |
|                          |                                       | • Willingness to punish unfair behavior toward others (prosocial punishment)                                |                  |
+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+
| Altruism                 | Combined quantitative and qualitative | • Quantitative: Hypothetical donation scenario (how much of 1,000 euros would be donated)                   | -2.6 -- 1.7      |
|                          |                                       |                                                                                                             |                  |
|                          |                                       | • Qualitative: Self-assessment on willingness to give without expecting returns (11-point Likert scale)     |                  |
+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+
| Trust                    | Single qualitative item               | • Self-assessment on whether others have the best intentions (11-point Likert scale)                        | -2 -- 1.7        |
+--------------------------+---------------------------------------+-------------------------------------------------------------------------------------------------------------+------------------+

::: {#tbl-gps .tbl-Economic}
Economic preferences from the Global Preference Survey
:::

| Value | Measurement approach | Description | Scale (min -- max) |
|----|----|----|----|
| Liberal democracy index (v2x_libdem) | Aggregation of **55 unique indicators** using Bayesian factor analysis | The indicators come from the Liberal Democracy index and Liberal component index. [Here](https://www.v-dem.net/documents/57/structureofaggregation.pdf) you can find the exact indicators. | **0**(least liberal democratic) **--** **1**(most liberal democratic) |

::: {#tbl-libdem .tbl-Liberal}
Liberal democracy index information
:::

## Sample period

Our sample period is defined by the birth years of the indviduals, which we calculated based on the age information in the GPS dataset. Each study unit (=individual) appears once. We had data for 80337 individuals. After merging and removing NAs it reduced to 75468.

## Treatment calculation

Since we have information about the age of each individual during the time of interview in the GPS survey, we were able to calculate their birth years. Then we could determine whether they experienced a regime change during their formative years, which we define following the literature as the period between 3 and 18 years of age. This definition aligns with the National Library of Medicine, which considers childhood as the stage from 3--11 years and adolescence from 12--18 years [@balasundaram_human_2025]. Research also supports that the formation of economic preferences such as patience and risk-taking during childhood and adolescence has lasting consequences for life outcomes, including educational attainment and financial decision-making [@detlefsen_are_2024].

To implement this classification, we linked the V-Dem dataset with the GPS survey data. Our objective was to separate individuals into treated and control groups based on the **Liberal Democracy Index (v2x_libdem)** from the V-Dem dataset. The treated group consists of individuals who experienced a regime change during their formative years (ages 3--18), while the control group did not. Also we calculated the amount of years spend after regime changes.

Following the methodology proposed by @luhrmann_autocratization_2020, we define regime change as a **substantial and statistically significant change in the Liberal Democracy Index over a 10-year period**. Specifically, we compute the difference between the index value at time **`t`** and time **`t–10`**. A change is considered *substantial* if the absolute value of the change exceeds **0.05**, and *significant* if the confidence intervals at time ***`t`*** and **`t–10`** do not overlap. This procedure captures both sudden and gradual transformations in regime type. After that, we gain following number of observations in each group, as shows in table @tbl-c.

```{r}
#| echo: false
#| label: tbl-c
#| tbl-cap: Number of treatment variables
#| tbl-pos: "H"
table(final_data$formative_regime_change)
```

## Variables

```{r}
#| echo: false
#| label: fig-a
#| warning: false
#| results: 'asis'
#| fig-cap: "Mean Preference Profiles by Regime Change Exposure"
#| fig-cap-location: top
#| fig-pos: "H"
long_data <- final_data_gdp %>%
  pivot_longer(
    cols = c(trust, patience, risktaking, posrecip, negrecip, altruism),
    names_to = "preference_type",
    values_to = "value"
  ) %>%
  mutate(preference_type = str_to_title(preference_type))

# Change the formative_regime_change factor levels and labels
long_data <- long_data %>%
  mutate(formative_regime_change = case_when(
    formative_regime_change == 0 ~ "Control",
    formative_regime_change == 1 ~ "Treated",
    TRUE ~ as.character(formative_regime_change)
  ))

# Calculating group means and confidence intervals
group_means <- long_data %>%
  group_by(formative_regime_change, preference_type) %>%
  summarise(
    mean_value = mean(value, na.rm = TRUE),
    se = sd(value, na.rm = TRUE) / sqrt(n()),
    ci_lower = mean_value - 1.96 * se,
    ci_upper = mean_value + 1.96 * se,
    .groups = "drop"
  )

# Order factors to make Treated come FIRST so it gets the first color (red in Set1)
group_means$formative_regime_change <- factor(
  group_means$formative_regime_change,
  levels = c("Treated", "Control")
)

# Ordering from smallest to highest differences between groups
differences <- group_means %>%
  select(preference_type, formative_regime_change, mean_value) %>%
  pivot_wider(names_from = formative_regime_change, values_from = mean_value) %>%
  mutate(difference = abs(Treated - Control)) %>%
  arrange(difference) %>%
  select(preference_type, difference)

# Create ordered factor for preference_type based on differences
group_means$preference_type <- factor(group_means$preference_type, 
                                      levels = differences$preference_type)

grouped_bar_plot <- ggplot(group_means, aes(x = preference_type, y = mean_value, fill = formative_regime_change)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8), width = 0.7) +
  geom_text(aes(label = round(mean_value, 3)), 
            position = position_dodge(width = 0.8), 
            vjust = ifelse(group_means$mean_value >= 0, -0.3, 1.2),
            size = 3.5,
            fontface = "bold") +
  scale_fill_manual(values = c("Treated" = "#D62728", "Control" = "#1F77B4"),
                    name = "Group") +
  scale_y_continuous(expand = expansion(mult = c(0.1, 0.1))) +  # Add space for labels
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title = element_text(size = 12),
    legend.position = "top"
  ) +
  labs(
    caption = "Mean values displayed above/below bars",
    x = element_blank(),
    y = "Mean Value"
  ) +
  geom_hline(yintercept = 0, linetype = "dotted", color = "gray50", size = 0.5)

# Print the plot
print(grouped_bar_plot)
```

In the @fig-a you can see simple mean comparison graph between Treated and Control group for all 6 economic preferences.For completeness, we include **summary statistics** table for all 6 economic preferences in @tbl-preferences. @tbl-controls depicts the summary statistics for our control variables.

```{r}
#| include: false
# Function to perform t-tests and format results
create_ttest_table <- function(data, vars) {
  
  # Initialize results list
  results <- list()
  
  # Ensure formative_regime_change is numeric
  data$formative_regime_change <- as.numeric(data$formative_regime_change)
  
  # Control vs Treatment indicators
  control_group <- data$formative_regime_change == 0
  treatment_group <- data$formative_regime_change == 1
  
  # Check that we have both groups
  if(sum(control_group) == 0) stop("No control group (formative_regime_change = 0) found")
  if(sum(treatment_group) == 0) stop("No treatment group (formative_regime_change = 1) found")
  
  # For each variable, perform t-test and extract statistics
  for(var in vars) {
    # Extract values for control and treatment
    control_vals <- data[[var]][control_group]
    treat_vals <- data[[var]][treatment_group]
    
    # Remove NA values
    control_vals <- control_vals[!is.na(control_vals)]
    treat_vals <- treat_vals[!is.na(treat_vals)]
    
    # Calculate means and SDs
    control_mean <- mean(control_vals)
    control_sd <- sd(control_vals)
    treat_mean <- mean(treat_vals)
    treat_sd <- sd(treat_vals)
    
    # Perform t-test
    t_test <- t.test(treat_vals, control_vals)
    diff <- treat_mean - control_mean
    p_value <- t_test$p.value
    
    # Add significance stars
    stars <- ifelse(p_value < 0.001, "***",
                   ifelse(p_value < 0.01, "**",
                         ifelse(p_value < 0.05, "*",
                               ifelse(p_value < 0.1, "+", ""))))
    
    # Format the results
    control_text <- sprintf("%.3f\n(%.3f)", control_mean, control_sd)
    treat_text <- sprintf("%.3f\n(%.3f)", treat_mean, treat_sd)
    diff_text <- sprintf("%.3f%s\n(%.3f)", diff, stars, t_test$stderr)
    
    # Store results
    results[[var]] <- c(
      Variable = var,
      Control = control_text,
      Treatment = treat_text,
      Difference = diff_text
    )
  }
  
  # Convert to data frame
  table_df <- do.call(rbind, results)
  row.names(table_df) <- NULL
  
  # Create the table using kableExtra for PDF output
  require(kableExtra)
  
  # Clean variable names for display
  display_names <- c(
    trust = "Trust",
    patience = "Patience",
    risktaking = "Risk Taking",
    posrecip = "Positive Reciprocity",
    negrecip = "Negative Reciprocity",
    altruism = "Altruism",
    subj_math_skills = "Subjective Math Skills"
  )
  
  # Replace variable names with display names
  table_df[,1] <- ifelse(table_df[,1] %in% names(display_names), 
                        display_names[table_df[,1]], 
                        table_df[,1])
  
  # Create styled table (without caption - handle in document)
  kbl(table_df, 
      booktabs = TRUE,
      col.names = c("", "Control Group", "Treatment Group", "Difference"),
      align = c("l", "c", "c", "c"),
      escape = TRUE) %>%
    kable_styling() %>%
    add_header_above(c(" " = 1, "Mean (SD)" = 3)) %>%
    column_spec(1, width = "2.5cm") %>%
    column_spec(2:4, width = "2cm") %>%
    footnote(general = "Standard deviations in parentheses. Standard errors for differences in parentheses.",
             symbol = c("*** p<0.001, ** p<0.01, * p<0.05, + p<0.1"),
             threeparttable = TRUE,
             general_title = "Note:",
             escape = TRUE)
}
```

```{r}
#| echo: false
#| label: tbl-preferences
#| warning: false
#| results: 'asis'
#| tbl-cap: "Economic Preferences Comparison by Group"
#| tbl-pos: "H"
# Create the table
preferences_vars <- c("trust", "patience", "risktaking", "posrecip", "negrecip", "altruism")
preferences_table <- create_ttest_table(final_data_gdp, preferences_vars)

# Render the table
preferences_table
```

```{r}
#| echo: false
#| label: tbl-controls
#| warning: false
#| results: 'asis'
#| tbl-cap: "Control Variables Comparison by Group"
#| tbl-pos: "H"
# Create the table
controls_vars <- c("age", "gdppc_2012", "subj_math_skills")
controls_table <- create_ttest_table(final_data_gdp, controls_vars)

# Render the table
controls_table
```

The @fig-b and @fig-o below depict the average values grouped by country in *2012* and *2013*.

```{r}
#| echo: false
#| label: fig-b
#| warning: false
#| results: 'asis'
#| fig-cap: "Average Economic Preference Values by Country: Trust, Patience, Altruism"
#| fig-cap-location: top
#| fig-pos: "H"
#| fig-width: 10
#| fig-height: 14


country_trust <- final_data_gdp %>%
  group_by(country, isocode) %>%
  summarise(mean_trust = mean(trust, na.rm = TRUE))

country_patience <- final_data_gdp %>%
  group_by(country, isocode) %>%
  summarise(mean_patience = mean(patience, na.rm = TRUE))

country_altruism <- final_data_gdp %>%
  group_by(country, isocode) %>%
  summarise(mean_altruism = mean(altruism, na.rm = TRUE))

country_risktaking <- final_data_gdp %>%
  group_by(country, isocode) %>%
  summarise(mean_risktaking = mean(risktaking, na.rm = TRUE))

country_posrecip <- final_data_gdp %>%
  group_by(country, isocode) %>%
  summarise(mean_posrecip = mean(posrecip, na.rm = TRUE))

country_negrecip <- final_data_gdp %>%
  group_by(country, isocode) %>%
  summarise(mean_negrecip = mean(negrecip, na.rm = TRUE))

# Getting world map data
#install.packages("rnaturalearth")
library(sf)
library(rnaturalearth)

world <- ne_countries(scale = "medium", returnclass = "sf")

# Creating two separate datasets
world_trust <- left_join(world, country_trust, by = c("name" = "country"))
world_patience <- left_join(world, country_patience, by = c("name" = "country"))
world_altruism <- left_join(world, country_altruism, by = c("name" = "country"))
world_risktaking<- left_join(world, country_risktaking, by = c("name" = "country"))
world_posrecip <- left_join(world, country_posrecip, by = c("name" = "country"))
world_negrecip <- left_join(world, country_negrecip, by = c("name" = "country"))

# Creating the plots separately and combining with grid.arrange using longer approach
# Trust map
p1 <- ggplot(data = world_trust) +
  geom_sf(aes(fill = mean_trust), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90") +
  labs(fill = "Mean trust",
       title = "Mean Trust values grouped by country") +
  theme_minimal()

# Patience map
p2 <- ggplot(data = world_patience) +
  geom_sf(aes(fill = mean_patience), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90") +
  labs(fill = "Mean patience",
       title = "Mean Patience values grouped by country") +
  theme_minimal()

# Altruism map
p3 <- ggplot(data = world_altruism) +
  geom_sf(aes(fill = mean_altruism), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90") +
  labs(fill = "Mean altruism",
       title = "Mean Altruism values grouped by country") +
  theme_minimal()

# Risktaking map
p4 <- ggplot(data = world_risktaking) +
  geom_sf(aes(fill = mean_risktaking), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90") +
  labs(fill = "Mean risktaking",
       title = "Mean Risk taking values grouped by country") +
  theme_minimal()

# Posrecip map
p5 <- ggplot(data = world_posrecip) +
  geom_sf(aes(fill = mean_posrecip), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90") +
  labs(fill = "Mean posrecip",
       title = "Mean Positive Reciprocity values grouped by country") +
  theme_minimal()

# Negrecip map
p6 <- ggplot(data = world_negrecip) +
  geom_sf(aes(fill = mean_negrecip), color = "white") +
  scale_fill_viridis_c(option = "C", na.value = "grey90") +
  labs(fill = "Mean negrecip",
       title = "Mean Negative Reciprocity values grouped by country") +
  theme_minimal()
# Combining

#install.packages("gridExtra")
library(gridExtra)
combined_plot <- grid.arrange(p1, p2, p3, ncol = 1)
```

```{r}
#| echo: false
#| label: fig-o
#| warning: false
#| results: 'asis'
#| fig-cap: "Average Economic Preference Values by Country: Risk, Negative and Positive reciprocity"
#| fig-cap-location: top
#| fig-pos: "H"
#| fig-width: 10
#| fig-height: 14

combined_plot2 <- grid.arrange(p4, p5, p6, ncol = 1)
```

# **Descriptive statistics**

The following figures present a detailed **visual overview of the descriptive statistics**, including distribution histograms, group-level comparisons, and difference-in-differences style visualizations highlighting trends across cohorts.

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-c
#| results: 'asis'
#| fig-cap: "Distribution of Key Economic Preferences"
#| fig-cap-location: top
#| 
# Function to create histograms with density overlays
create_histogram <- function(data, var_name, title) {
  ggplot(data, aes(x = !!sym(var_name), fill = formative_regime_change, color = formative_regime_change)) +
    geom_histogram(aes(y = after_stat(density)), alpha = 0.5, position = "identity", bins = 30) +
     
    scale_fill_brewer(palette = "Set1", name = "Formative Years") +
    scale_color_brewer(palette = "Set1", name = "Formative Years") +
    theme_minimal()
}

# Create histograms for key variables
trust_hist <- create_histogram(final_data_gdp, "trust", "Distribution of Trust")
patience_hist <- create_histogram(final_data_gdp, "patience", "Distribution of Patience")
risk_hist <- create_histogram(final_data_gdp, "risktaking", "Distribution of Risk Taking")



library(patchwork)


# Combine the plots correctly with patchwork
histograms_combined <- (trust_hist + patience_hist + risk_hist) +
  plot_layout(ncol = 3, guides = "collect") +
  plot_annotation(
    subtitle = "By regime change exposure during formative years ",
    theme = theme(plot.title = element_text(size = 16, face = "bold"))
  ) &
  theme(legend.position = "bottom")

# Show the plot
histograms_combined

```

The following figures present additional visualizations of our data. In the following graphs @fig-d, @fig-e, @fig-f, @fig-g, @fig-h, @fig-i we are aiming to examine the **parallel trends assumption** between treated and control groups in all 6 economic preferences.

```{r}
#| warning: false
#| fig-pos: H
#| include: false

#Creating age groups for visualization
final_data_gdp <- final_data_gdp %>%
  mutate(
    age_group = cut(age, breaks = seq(15, 75, by = 5), include.lowest = TRUE)
  )
analyze_by_age_regime <- function(data, variable_name, min_group_size = 10, 
                                 label_format = "%.2f", 
                                 label_offset = 0.05,
                                 # New parameters for label positioning
                                 first_level_label_position = "above",  # Options: "above" or "below"
                                 colors = c("#1F77B4", "#D62728"),            # Colors for the two groups
                                 group_labels = c("No", "Yes")) {      # Labels for the legend
  
  # Analysis part
  result_data <- data %>%
    filter(!is.na(get(variable_name)), !is.na(formative_regime_change), !is.na(age_group)) %>%
    group_by(age_group, formative_regime_change) %>%
    summarize(
      mean_value = mean(get(variable_name), na.rm = TRUE),
      se_value = sd(get(variable_name), na.rm = TRUE) / sqrt(n()),
      n = n(),
      .groups = 'drop'
    ) %>%
    filter(n >= min_group_size)  # only including groups with sufficient observations
  
  # Format the labels for display
  result_data$label <- sprintf(label_format, result_data$mean_value)
  
  # Convert formative_regime_change to factor to ensure it's treated as discrete
  result_data$formative_regime_change <- as.factor(result_data$formative_regime_change)
  
  # Determine positioning based on the function parameter
  if (first_level_label_position == "above") {
    # First level (1) gets labels above, second level (2) gets labels below
    result_data <- result_data %>%
      mutate(
        label_position = ifelse(as.integer(formative_regime_change) == 1, 
                               mean_value + label_offset + se_value*0.5,  # Above for first level
                               mean_value - label_offset - se_value*0.5), # Below for second level
        vjust_value = ifelse(as.integer(formative_regime_change) == 1, 0, 1)
      )
  } else {
    # First level (1) gets labels below, second level (2) gets labels above
    result_data <- result_data %>%
      mutate(
        label_position = ifelse(as.integer(formative_regime_change) == 1, 
                               mean_value - label_offset - se_value*0.5,  # Below for first level
                               mean_value + label_offset + se_value*0.5), # Above for second level
        vjust_value = ifelse(as.integer(formative_regime_change) == 1, 1, 0)
      )
  }
  
  # Visualization part
  plot <- ggplot(result_data, aes(x = age_group, y = mean_value,
                                 group = formative_regime_change,
                                 color = formative_regime_change)) +
    geom_line(linewidth = 1) +
    geom_point(size = 3) +
    geom_errorbar(aes(ymin = mean_value - 1.96*se_value,
                      ymax = mean_value + 1.96*se_value),
                 width = 0.2) +
    # Add labels with custom positioning
    geom_text(aes(label = label, y = label_position, vjust = vjust_value), 
              size = 3, show.legend = FALSE) +
    labs(x = "Age Group",
         y = paste("Mean", variable_name),
         color = "Regime Change Experience") +
    # Manually set the color scale with appropriate labels
    scale_color_manual(values = colors, labels = group_labels) +
    theme_minimal() +
    theme(legend.position = "bottom",
          axis.text.x = element_text(angle = 45, hjust = 1),
          legend.text = element_text(size = 8))
  
  # Return both the data and the plot
  return(list(data = result_data, plot = plot))
}
```

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-d
#| results: 'asis'
#| fig-cap: "Trust by Age Cohort and Regime Change Experience"
#| fig-cap-location: top

trust_results <- analyze_by_age_regime(final_data_gdp, "trust", first_level_label_position = "above")

trust_results$plot 
```

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-e
#| results: 'asis'
#| fig-cap: "Patience by Age Cohort and Regime Change Experience"
#| fig-cap-location: top
patience_results <- analyze_by_age_regime(final_data_gdp, "patience")

patience_results$plot 
```

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-f
#| results: 'asis'
#| fig-cap: "Risk Taking by Age Cohort and Regime Change Experience"
#| fig-cap-location: top
risktaking_results <- analyze_by_age_regime(final_data_gdp, "risktaking")

risktaking_results$plot 
```

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-g
#| results: 'asis'
#| fig-cap: "Altruism by Age Cohort and Regime Change Experience"
#| fig-cap-location: top
altruism_results <- analyze_by_age_regime(final_data_gdp, "altruism")

altruism_results$plot 
```

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-h
#| results: 'asis'
#| fig-cap: "Negative Reciprocity by Age Cohort and Regime Change Experience"
#| fig-cap-location: top
negrecip_results <- analyze_by_age_regime(final_data_gdp, "negrecip")

negrecip_results$plot 
```

```{r}
#| echo: false
#| warning: false
#| fig-pos: "H"
#| label: fig-i
#| results: 'asis'
#| fig-cap: "Positive Reciprocity by Age Cohort and Regime Change Experience"
#| fig-cap-location: top
posrecip_results <- analyze_by_age_regime(final_data_gdp, "posrecip")

posrecip_results$plot 
```

```{r}
#| eval: false
#| include: false
democracy_2012 <- vdem_sub %>%
  filter(year == 2012) %>%
  select(country_name,country_text_id, v2x_libdem)
# Merge democracy index into the individual-level dataset
mixed_plot_data <- left_join(final_data_gdp, democracy_2012, by =c ("country"= "country_name"))

ggplot(mixed_plot_data, aes(x = subj_math_skills, y = trust, color = formative_regime_change)) + 
  geom_smooth(method = "loess", se = FALSE, size = 1.2) +
  theme_minimal() +
  labs(title = "Trust Score vs. Subjective Math Skills by Regime Change Exposure",
       x = "Subjective Math Skills",
       y = "Trust",
       color = "Formative Regime Change")
```

# References

::: {#refs}
:::
